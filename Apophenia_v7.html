<!DOCTYPE html>
<html>

<head>
    <title>Apophenia task</title>
    <script src="https://unpkg.com/jspsych@7.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.0.0"></script>
    <script src="https://unpkg.com/@jspsych/pluginAPI@1.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-slider-response@1.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-preload@1.0.0"></script>
    <link href="https://unpkg.com/jspsych@7.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />
    </head>
<script>
    //const jsPsych = initJsPsych({
    ///    defult_iti: 0
    ///});

    var jsPsych = initJsPsych({
        on_finish: function () {
            // get the ID that was entered from the jsPsych data
            var id = jsPsych.data.get().filter({ task_part: 'id_question' }).values()[0].response.id;
            // add this ID to the data for all trials
            jsPsych.data.addProperties({ ID: id });
            // combine the subject ID with the file extension (and any other text) to dynamically create the file name
            var file_name = 'subject_' + id + '_data.csv';
            // save the data with this file name
            jsPsych.data.get().localSave('csv', file_name);
        }
    });

    var timeline = [];

    /* init connection with pavlovia.org */
    var pavlovia_init = '{'
        type: "pavlovia",
        command: "init"
    '}';
    timeline.push(pavlovia_init);

    var id = {
        type: jsPsychSurveyText,
        questions: [{ prompt: 'Please enter your ID.', name: 'id', required: true }],
        data: { task_part: 'id_question' }
    };
    timeline.push(id);

    var introduction = {
        type: jsPsychHtmlKeyboardResponse,
        stimulus: "You will see a series of images. Press the space bar when you think you see something. Press the space bar to begin.",
        choices: "ALL_KEYS"
    }
    timeline.push(introduction)

    var test_stimuli = [
        { stimulus: 'Steve_step_1_round_1.jpg' },
        { stimulus: 'Steve_step_1_round_2.jpg' },
        { stimulus: 'Steve_step_1_round_3.jpg' },
        { stimulus: 'Steve_step_1_round_4.jpg' },
        { stimulus: 'Steve_step_1_round_5.jpg' },
        { stimulus: 'Steve_step_1_round_6.jpg' },
        { stimulus: 'Steve_step_1_round_7.jpg' },
        { stimulus: 'Steve_step_2_round_1.jpg' },
        { stimulus: 'Steve_step_2_round_2.jpg' },
        { stimulus: 'Steve_step_2_round_3.jpg' },
        { stimulus: 'Steve_step_2_round_4.jpg' },
        { stimulus: 'Steve_step_2_round_5.jpg' },
        { stimulus: 'Steve_step_2_round_6.jpg' },
        { stimulus: 'Steve_step_2_round_7.jpg' },
        { stimulus: 'Steve_step_3_round_1.jpg' },
        { stimulus: 'Steve_step_3_round_2.jpg' },
        { stimulus: 'Steve_step_3_round_3.jpg' },
        { stimulus: 'Steve_step_3_round_4.jpg' },
        { stimulus: 'Steve_step_3_round_5.jpg' },
        { stimulus: 'Steve_step_3_round_6.jpg' },
        { stimulus: 'Steve_step_3_round_7.jpg' },
        { stimulus: 'Steve_step_4_round_1.jpg' },
        { stimulus: 'Steve_step_4_round_2.jpg' },
        { stimulus: 'Steve_step_4_round_3.jpg' },
        { stimulus: 'Steve_step_4_round_4.jpg' },
        { stimulus: 'Steve_step_4_round_5.jpg' },
        { stimulus: 'Steve_step_4_round_6.jpg' },
        { stimulus: 'Steve_step_4_round_7.jpg' },
        { stimulus: 'Steve_step_5_round_1.jpg' },
        { stimulus: 'Steve_step_5_round_2.jpg' },
        { stimulus: 'Steve_step_5_round_3.jpg' },
        { stimulus: 'Steve_step_5_round_4.jpg' },
        { stimulus: 'Steve_step_5_round_5.jpg' },
        { stimulus: 'Steve_step_5_round_6.jpg' },
        { stimulus: 'Steve_step_5_round_7.jpg' },
        { stimulus: 'Steve_step_6_round_1.jpg' },
        { stimulus: 'Steve_step_6_round_2.jpg' },
        { stimulus: 'Steve_step_6_round_3.jpg' },
        { stimulus: 'Steve_step_6_round_4.jpg' },
        { stimulus: 'Steve_step_6_round_5.jpg' },
        { stimulus: 'Steve_step_6_round_6.jpg' },
        { stimulus: 'Steve_step_6_round_7.jpg' },
        { stimulus: 'Steve_step_7_round_1.jpg' },
        { stimulus: 'Steve_step_7_round_2.jpg' },
        { stimulus: 'Steve_step_7_round_3.jpg' },
        { stimulus: 'Steve_step_7_round_4.jpg' },
        { stimulus: 'Steve_step_7_round_5.jpg' },
        { stimulus: 'Steve_step_7_round_6.jpg' },
        { stimulus: 'Steve_step_7_round_7.jpg' },
        { stimulus: 'Steve_step_8_round_1.jpg' },
        { stimulus: 'Steve_step_8_round_2.jpg' },
        { stimulus: 'Steve_step_8_round_3.jpg' },
        { stimulus: 'Steve_step_8_round_4.jpg' },
        { stimulus: 'Steve_step_8_round_5.jpg' },
        { stimulus: 'Steve_step_8_round_6.jpg' },
        { stimulus: 'Steve_step_8_round_7.jpg' },
        { stimulus: 'Steve_step_9_round_1.jpg' },
        { stimulus: 'Steve_step_9_round_2.jpg' },
        { stimulus: 'Steve_step_9_round_3.jpg' },
        { stimulus: 'Steve_step_9_round_4.jpg' },
        { stimulus: 'Steve_step_9_round_5.jpg' },
        { stimulus: 'Steve_step_9_round_6.jpg' },
        { stimulus: 'Steve_step_9_round_7.jpg' },
        { stimulus: 'Steve_step_10_round_1.jpg' },
        { stimulus: 'Steve_step_10_round_2.jpg' },
        { stimulus: 'Steve_step_10_round_3.jpg' },
        { stimulus: 'Steve_step_10_round_4.jpg' },
        { stimulus: 'Steve_step_10_round_5.jpg' },
        { stimulus: 'Steve_step_10_round_6.jpg' },
        { stimulus: 'Steve_step_10_round_7.jpg' },
        { stimulus: 'Steve_step_11_round_1.jpg' },
        { stimulus: 'Steve_step_11_round_2.jpg' },
        { stimulus: 'Steve_step_11_round_3.jpg' },
        { stimulus: 'Steve_step_11_round_4.jpg' },
        { stimulus: 'Steve_step_11_round_5.jpg' },
        { stimulus: 'Steve_step_11_round_6.jpg' },
        { stimulus: 'Steve_step_11_round_7.jpg' },
        { stimulus: 'Steve_step_12_round_1.jpg' },
        { stimulus: 'Steve_step_12_round_2.jpg' },
        { stimulus: 'Steve_step_12_round_3.jpg' },
        { stimulus: 'Steve_step_12_round_4.jpg' },
        { stimulus: 'Steve_step_12_round_5.jpg' },
        { stimulus: 'Steve_step_12_round_6.jpg' },
        { stimulus: 'Steve_step_12_round_7.jpg' },
        { stimulus: 'Steve_step_13_round_1.jpg' },
        { stimulus: 'Steve_step_13_round_2.jpg' },
        { stimulus: 'Steve_step_13_round_3.jpg' },
        { stimulus: 'Steve_step_13_round_4.jpg' },
        { stimulus: 'Steve_step_13_round_5.jpg' },
        { stimulus: 'Steve_step_13_round_6.jpg' },
        { stimulus: 'Steve_step_13_round_7.jpg' },
        { stimulus: 'Steve_step_14_round_1.jpg' },
        { stimulus: 'Steve_step_14_round_2.jpg' },
        { stimulus: 'Steve_step_14_round_3.jpg' },
        { stimulus: 'Steve_step_14_round_4.jpg' },
        { stimulus: 'Steve_step_14_round_5.jpg' },
        { stimulus: 'Steve_step_14_round_6.jpg' },
        { stimulus: 'Steve_step_14_round_7.jpg' },
        { stimulus: 'Steve_step_15_round_1.jpg' },
        { stimulus: 'Steve_step_15_round_2.jpg' },
        { stimulus: 'Steve_step_15_round_3.jpg' },
        { stimulus: 'Steve_step_15_round_4.jpg' },
        { stimulus: 'Steve_step_15_round_5.jpg' },
        { stimulus: 'Steve_step_15_round_6.jpg' },
        { stimulus: 'Steve_step_15_round_7.jpg' },
        { stimulus: 'Steve_step_16_round_1.jpg' },
        { stimulus: 'Steve_step_16_round_2.jpg' },
        { stimulus: 'Steve_step_16_round_3.jpg' },
        { stimulus: 'Steve_step_16_round_4.jpg' },
        { stimulus: 'Steve_step_16_round_5.jpg' },
        { stimulus: 'Steve_step_16_round_6.jpg' },
        { stimulus: 'Steve_step_16_round_7.jpg' },
        { stimulus: 'Steve_step_17_round_1.jpg' },
        { stimulus: 'Steve_step_17_round_2.jpg' },
        { stimulus: 'Steve_step_17_round_3.jpg' },
        { stimulus: 'Steve_step_17_round_4.jpg' },
        { stimulus: 'Steve_step_17_round_5.jpg' },
        { stimulus: 'Steve_step_17_round_6.jpg' },
        { stimulus: 'Steve_step_17_round_7.jpg' },
        { stimulus: 'Steve_step_18_round_1.jpg' },
        { stimulus: 'Steve_step_18_round_2.jpg' },
        { stimulus: 'Steve_step_18_round_3.jpg' },
        { stimulus: 'Steve_step_18_round_4.jpg' },
        { stimulus: 'Steve_step_18_round_5.jpg' },
        { stimulus: 'Steve_step_18_round_6.jpg' },
        { stimulus: 'Steve_step_18_round_7.jpg' },
        { stimulus: 'Steve_step_19_round_1.jpg' },
        { stimulus: 'Steve_step_19_round_2.jpg' },
        { stimulus: 'Steve_step_19_round_3.jpg' },
        { stimulus: 'Steve_step_19_round_4.jpg' },
        { stimulus: 'Steve_step_19_round_5.jpg' },
        { stimulus: 'Steve_step_19_round_6.jpg' },
        { stimulus: 'Steve_step_19_round_7.jpg' },
        { stimulus: 'Steve_step_20_round_1.jpg' },
        { stimulus: 'Steve_step_20_round_2.jpg' },
        { stimulus: 'Steve_step_20_round_3.jpg' },
        { stimulus: 'Steve_step_20_round_4.jpg' },
        { stimulus: 'Steve_step_20_round_5.jpg' },
        { stimulus: 'Steve_step_20_round_6.jpg' },
        { stimulus: 'Steve_step_20_round_7.jpg' },
        { stimulus: 'Steve_step_21_round_1.jpg' },
        { stimulus: 'Steve_step_21_round_2.jpg' },
        { stimulus: 'Steve_step_21_round_3.jpg' },
        { stimulus: 'Steve_step_21_round_4.jpg' },
        { stimulus: 'Steve_step_21_round_5.jpg' },
        { stimulus: 'Steve_step_21_round_6.jpg' },
        { stimulus: 'Steve_step_21_round_7.jpg' },
        { stimulus: 'Steve_step_22_round_1.jpg' },
        { stimulus: 'Steve_step_22_round_2.jpg' },
        { stimulus: 'Steve_step_22_round_3.jpg' },
        { stimulus: 'Steve_step_22_round_4.jpg' },
        { stimulus: 'Steve_step_22_round_5.jpg' },
        { stimulus: 'Steve_step_22_round_6.jpg' },
        { stimulus: 'Steve_step_22_round_7.jpg' },
        { stimulus: 'Steve_step_23_round_1.jpg' },
        { stimulus: 'Steve_step_23_round_2.jpg' },
        { stimulus: 'Steve_step_23_round_3.jpg' },
        { stimulus: 'Steve_step_23_round_4.jpg' },
        { stimulus: 'Steve_step_23_round_5.jpg' },
        { stimulus: 'Steve_step_23_round_6.jpg' },
        { stimulus: 'Steve_step_23_round_7.jpg' },
        { stimulus: 'Steve_step_24_round_1.jpg' },
        { stimulus: 'Steve_step_24_round_2.jpg' },
        { stimulus: 'Steve_step_24_round_3.jpg' },
        { stimulus: 'Steve_step_24_round_4.jpg' },
        { stimulus: 'Steve_step_24_round_5.jpg' },
        { stimulus: 'Steve_step_24_round_6.jpg' },
        { stimulus: 'Steve_step_24_round_7.jpg' },
        { stimulus: 'Steve_step_25_round_1.jpg' },
        { stimulus: 'Steve_step_25_round_2.jpg' },
        { stimulus: 'Steve_step_25_round_3.jpg' },
        { stimulus: 'Steve_step_25_round_4.jpg' },
        { stimulus: 'Steve_step_25_round_5.jpg' },
        { stimulus: 'Steve_step_25_round_6.jpg' },
        { stimulus: 'Steve_step_25_round_7.jpg' },
    ];

    var init_response = 1;

    var preload = {
        type: jsPsychPreload,
        auto_preload: true
    }

    var trials = {
        type: jsPsychImageKeyboardResponse,
        choices: " ",
        // prompt: "<p>Press the space bar if you see an object",
        trial_duration: 400,
        stimulus: jsPsych.timelineVariable('stimulus'),
        post_trial_gap: 0,
        // render_on_canvas: true,
        on_finish: function (data) {
            if (jsPsych.pluginAPI.compareKeys(data.response, ' ')) {
                init_response = 1;
            } else {
                init_response = 0;
            }
        }
    };

    var response_trial = {
        type: jsPsychSurveyText,
        questions: [
            { prompt: 'What did you see?' }
        ]
    }

    var certainty_trial = {
        type: jsPsychHtmlSliderResponse,
        stimulus: "<p>How certain are you?",
        require_movement: true,
        labels: ['0%','50%','100%']
    }

    var response_initiated = {
        timeline: [response_trial,certainty_trial],
        conditional_function: function () {
            if (init_response == 1) { return true; }
            return false;
        }
    }

    var test_procedure = {
        timeline: [trials, response_initiated],
        timeline_variables: test_stimuli,
    };
    timeline.push(test_procedure)

    var pavlovia_finish = '{'
        type: "pavlovia",
        command: "finish"
    '}';
    timeline.push(pavlovia_finish);

    jsPsych.run(timeline);
</script>

</html>